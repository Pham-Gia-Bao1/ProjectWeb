<!DOCTYPE html>
<html>
  <head>
    <title>Product Search</title>
    <link rel="stylesheet" href="/page/home/home.css">
    <link rel="stylesheet" href="/page/home/reponsive_nav.css">
  </head>

  <body>
    <div class="search-container">
      <input
        id="searchInput"
        class="search-container__input"
        type="text"
        placeholder="Tìm kiếm..."
        required
      />
      <button id="searchButton" type="submit">
        <i style="font-size: 20px" class="fa fa-search"></i>
      </button>
    </div>
    <ul id="suggestionList"></ul>
    <div id="product"></div>

    <script>
      const searchInput = document.getElementById("searchInput");
      const suggestionList = document.getElementById("suggestionList");
      const searchButton = document.getElementById("searchButton");
      const productContainer = document.getElementById("product");

      searchInput.addEventListener("input", function () {
        const searchValue = searchInput.value.toLowerCase();
        searchProductByName(searchValue);
        document.getElementById("suggestionList").style.display = "block";
      });

      searchButton.addEventListener("click", function (event) {
        event.preventDefault(); // Ngăn chặn sự kiện submit mặc định của button
        const searchValue = searchInput.value.toLowerCase();
        searchProductByName(searchValue);
        document.getElementById("suggestionList").style.display = "none";
        displayProducts(searchValue);
      });

      function searchProductByName(searchTerm) {
        fetch("http://localhost:3000/product")
          .then((response) => response.json())
          .then((data) => {
            const matchingSuggestions = data.filter(function (product) {
              return product.name.toLowerCase().includes(searchTerm);
            });
            displaySuggestions(matchingSuggestions);
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }

      function displaySuggestions(suggestions) {
        suggestionList.innerHTML = "";
        suggestions.forEach(function (suggestion) {
          const listItem = document.createElement("li");
          listItem.textContent = suggestion.name;
          listItem.addEventListener("click", function () {
            searchInput.value = suggestion.name;
            suggestionList.innerHTML = "";
            document.getElementById("suggestionList").style.display = "none";
          });
          suggestionList.appendChild(listItem);
        });
      }

      function displayProducts(searchTerm) {
        fetch("http://localhost:3000/product")
          .then((response) => response.json())
          .then((data) => {
              const matchingProducts = data.filter(function (product) {
                  return product.name.toLowerCase().includes(searchTerm);
                });
                if (matchingProducts.length === 0) {
                    const notFoundMessage = document.createElement("div");
                    notFoundMessage.textContent = "Not found";
                    productContainer.innerHTML = "";
                    productContainer.appendChild(notFoundMessage);
                } else {
                    productContainer.innerHTML = "";
                    matchingProducts.forEach(function (product) {
                  console.log(product.id,"helllo")
                const productItem = document.createElement("div");
                productItem.innerHTML = `
                            
                            <div class="product">
    <a target="_self" id="card" href="/page/product/ProductDetail/ProductDetail.html?id=${product.id}">
        <p id="evaluate1">${product.productReviews}<i class="material-symbols-outlined">star</i></p>
        <img id="main_img" src="${product.image1}" alt="${product.name}">
        <h2>${product.name}</h2>
        <div class="price">
            <p>${product.newPrice} VND</p>
            <p>${product.oldPrice} VND</p>
        </div>
    </a>
    <div class="descriptiom_and_btn">
        <p>${product.description}</p>
        <div class="icon-container">
        <div class="ccontain_btn">
        <button class="icon-btn" id="btn_favorite">
          <i class="fas fa-heart"></i>
      </button>
      <button class="icon-btn" id="btn_view">
      <i class="fas fa-star"></i> <!-- Thay thế icon View/Star -->
      </button>
      <button class="icon-btn" id="btn_share">
      <i class="fas fa-share"></i> <!-- Giữ nguyên icon Share -->
      </button>
      </button>
      </div>
            <button id="btn_buy" onclick="redirectToOrderPage(${product.id})">
                <i id="icon_cart" class="fas fa-shopping-cart"></i>Buy
            </button>
        </div>
    </div>
</div>
                    
                            
                            
                            `;
                // productItem.textContent = product.name;
                // productItem.textContent = product.image1;

                // console.log(product.image1)
                productContainer.appendChild(productItem);
              });
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }

      // Xóa dữ liệu khi input rỗng
      searchInput.addEventListener("input", function () {
        if (searchInput.value === "") {
          suggestionList.innerHTML = "";
          document.getElementById("suggestionList").style.display = "none";
          productContainer.innerHTML = "";
        }
      });
    </script>
  </body>
</html>
